<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.liuyang.mapper.PlaylistMapper">
    <insert id="createPlaylist">
        insert into playlist
        (name,img,author,time,description,cnt)
        values
        (#{name},#{img},#{author},#{time},#{description},#{cnt});
    </insert>
    <insert id="createStyle">
        insert into playlist_style(style,list_id) values(#{style},#{list_id});
    </insert>
    <insert id="addSong_to_playlist">
        insert into song_playlist_relationship(list_id,song_id) values(#{list_id},#{song_id});
    </insert>
    <insert id="addSong_to_like">
        insert into `like` (mailbox,song_id) values(#{mailbox},#{song_id});
    </insert>
    <insert id="addCollectionPlaylist">
        insert into user_playlist_relationship (mailbox,list_id) values(#{mailbox},#{list_id});
    </insert>
    <update id="addCnt">
        UPDATE playlist set cnt = cnt+1 WHERE id = #{id};
    </update>
    <update id="revisePlayliet">
        UPDATE playlist SET name = #{name}, img = #{img}, description = #{description} WHERE id = #{id}
    </update>
    <delete id="deletePlaylist">
        DELETE FROM playlist WHERE id = #{id};
    </delete>

    <delete id="deletePlaylistStyle">
        DELETE FROM playlist_style WHERE list_id = #{id};
    </delete>
    <delete id="deletePlaylistSong">
        DELETE FROM song_playlist_relationship WHERE list_id = #{id};
    </delete>
    <delete id="delete_likeSong">
        delete from `like` where `mailbox`=#{mailbox} and song_id=#{song_id};
    </delete>
    <delete id="delete_playlistSong">
        delete from song_playlist_relationship where list_id=#{list_id} and song_id=#{song_id};
    </delete>
    <delete id="deleteCollectionPlaylist">
        delete from user_playlist_relationship where mailbox=#{mailbox} and list_id = #{list_id};
    </delete>

    <select id="selectNewPlaylist" resultType="com.liuyang.pojo.Playlist">
        SELECT * FROM playlist ORDER BY id DESC LIMIT 1
    </select>
    <!--所有歌单-->
    <select id="selectALL" resultType="com.liuyang.pojo.Playlist">
        select * from playlist;
    </select>

    <select id="selectPlayList" resultType="com.liuyang.pojo.Playlist">
        SELECT * FROM playlist LIMIT 10 OFFSET 0;
    </select>
    <select id="selectStyle" resultType="com.liuyang.pojo.Playlist">
        SELECT * FROM playlist WHERE id IN (SELECT list_id FROM playlist_style WHERE style = #{style});
    </select>
    <select id="selectByID" resultType="com.liuyang.pojo.Playlist">
        select * from playlist where id=#{id};
    </select>
    <select id="selectHot" resultType="com.liuyang.pojo.Playlist">
        SELECT * FROM ( SELECT * FROM playlist ORDER BY cnt DESC LIMIT 200 ) AS subquery ORDER BY RAND() LIMIT 8;
    </select>
    <select id="selectPersonality" resultType="com.liuyang.pojo.Playlist">
        SELECT * FROM ( SELECT * FROM playlist ORDER BY cnt DESC LIMIT 200 ) AS subquery ORDER BY RAND() LIMIT 4;
    </select>
    <select id="selectByAuthor" resultType="com.liuyang.pojo.Playlist">
        select * from playlist where author = #{author};
    </select>
    <select id="selectLabel" resultType="java.lang.String">
        select style from playlist_style where list_id = #{id};
    </select>
    <select id="selectBySong" resultType="java.lang.Integer">
        select COUNT(*) from song_playlist_relationship where list_id=#{list_id} and song_id=#{song_id};
    </select>
    <select id="selectBySongLike" resultType="java.lang.Integer">
        select COUNT(*) from `like` where mailbox=#{mailbox} and song_id=#{song_id};
    </select>
    <select id="selectCollectionPlaylist" resultType="com.liuyang.pojo.Playlist"><!--查找用户收藏的歌单-->
        SELECT * FROM playlist WHERE id IN (SELECT list_id FROM user_playlist_relationship WHERE mailbox = #{mailbox});
    </select>
    <select id="selectPlaylistDoText" resultType="com.liuyang.pojo.Playlist">
        SELECT * FROM playlist WHERE name LIKE CONCAT('%', #{name}, '%') OR author LIKE CONCAT('%', #{name}, '%');
    </select>
    <select id="selectPlayCnt" resultType="java.lang.Integer">
        SELECT COUNT(*) AS count FROM user_playlist_relationship WHERE list_id = #{id};
    </select>


</mapper>







